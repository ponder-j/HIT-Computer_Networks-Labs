# è®¡ç®—æœºç½‘ç»œå®éªŒLab2 - å®Œæ•´å®éªŒæŠ¥å‘Š

## å®éªŒæ¦‚è¿°

æœ¬å®éªŒå®Œæˆäº†å¯é æ•°æ®ä¼ è¾“åè®®çš„è®¾è®¡ä¸å®ç°,åŒ…æ‹¬å¿…åšå†…å®¹å’Œæ‰€æœ‰é€‰åšå†…å®¹ã€‚

## å®éªŒå®Œæˆæƒ…å†µ

### âœ… Lab2-1: åœç­‰åè®®

#### å¿…åšå†…å®¹
- âœ… åŸºäºUDPçš„åœç­‰åè®®å®ç°(å•å‘ä¼ è¾“)
- âœ… æ•°æ®åŒ…ä¸¢å¤±æ¨¡æ‹Ÿä¸éªŒè¯
- ğŸ“ ä½ç½®: `Lab2-1/`

#### é€‰åšå†…å®¹
- âœ… **é€‰åš1**: åŒå‘æ•°æ®ä¼ è¾“çš„åœç­‰åè®®
  - ğŸ“ ä½ç½®: `Lab2-1/bidirectional/`
  - æ”¯æŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯åŒå‘é€šä¿¡
  - ç‹¬ç«‹ç»´æŠ¤å‘é€å’Œæ¥æ”¶åºåˆ—å·

- âœ… **é€‰åš2**: æ–‡ä»¶ä¼ è¾“åº”ç”¨
  - ğŸ“ ä½ç½®: `Lab2-1/file_transfer/`
  - C/Sç»“æ„çš„æ–‡ä»¶ä¼ è¾“ç³»ç»Ÿ
  - æ”¯æŒä»»æ„å¤§å°æ–‡ä»¶å¯é ä¼ è¾“
  - å®æ—¶è¿›åº¦æ˜¾ç¤º

### âœ… Lab2-2: GBNåè®®

#### å¿…åšå†…å®¹
- âœ… åŸºäºUDPçš„GBNåè®®å®ç°(å•å‘ä¼ è¾“)
- âœ… æ•°æ®åŒ…å’ŒACKä¸¢å¤±æ¨¡æ‹Ÿ
- ğŸ“ ä½ç½®: `Lab2-2/`

#### é€‰åšå†…å®¹
- âœ… **é€‰åš2**: SRåè®®(é€‰æ‹©é‡ä¼ )
  - ğŸ“ ä½ç½®: `Lab2-2/SR_protocol/`
  - æ¥æ”¶çª—å£>1,ç¼“å­˜ä¹±åºåŒ…
  - é€‰æ‹©é‡ä¼ ,æ•ˆç‡æœ€é«˜

## ç›®å½•ç»“æ„

```
Computer_Networks_Labs/
â”œâ”€â”€ README_Lab2.md                    # æ€»ä½“è¯´æ˜
â”‚
â”œâ”€â”€ Lab2-1/                           # åœç­‰åè®®
â”‚   â”œâ”€â”€ server.cpp                    # åŸºç¡€æœåŠ¡å™¨
â”‚   â”œâ”€â”€ client.cpp                    # åŸºç¡€å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ README.md                     # è¯´æ˜æ–‡æ¡£
â”‚   â”œâ”€â”€ å®éªŒè¦æ±‚.md
â”‚   â”‚
â”‚   â”œâ”€â”€ bidirectional/                # é€‰åš1:åŒå‘ä¼ è¾“
â”‚   â”‚   â”œâ”€â”€ server.cpp
â”‚   â”‚   â”œâ”€â”€ client.cpp
â”‚   â”‚   â””â”€â”€ README.md
â”‚   â”‚
â”‚   â””â”€â”€ file_transfer/                # é€‰åš2:æ–‡ä»¶ä¼ è¾“
â”‚       â”œâ”€â”€ server.cpp
â”‚       â”œâ”€â”€ client.cpp
â”‚       â”œâ”€â”€ test_file.txt
â”‚       â””â”€â”€ README.md
â”‚
â””â”€â”€ Lab2-2/                           # GBNåè®®
    â”œâ”€â”€ server.cpp                    # åŸºç¡€æœåŠ¡å™¨
    â”œâ”€â”€ client.cpp                    # åŸºç¡€å®¢æˆ·ç«¯
    â”œâ”€â”€ README.md                     # è¯´æ˜æ–‡æ¡£
    â”œâ”€â”€ README_OPTIONAL.md            # é€‰åšè¯´æ˜
    â”œâ”€â”€ å®éªŒè¦æ±‚.md
    â”‚
    â””â”€â”€ SR_protocol/                  # é€‰åš2:SRåè®®
        â”œâ”€â”€ server.cpp
        â”œâ”€â”€ client.cpp
        â””â”€â”€ README.md
```

## åè®®å®ç°å¯¹æ¯”

| åè®® | ç›®å½• | å‘é€çª—å£ | æ¥æ”¶çª—å£ | é‡ä¼ ç­–ç•¥ | æ•ˆç‡ | é€‚ç”¨åœºæ™¯ |
|------|------|---------|---------|---------|-----|---------|
| åœç­‰ | Lab2-1/ | 1 | 1 | å•ä¸ª | ä½ | ç®€å•åº”ç”¨ |
| åœç­‰(åŒå‘) | Lab2-1/bidirectional/ | 1 | 1 | å•ä¸ª | ä½ | åŒå‘é€šä¿¡ |
| åœç­‰(æ–‡ä»¶) | Lab2-1/file_transfer/ | 1 | 1 | å•ä¸ª | ä½ | æ–‡ä»¶ä¼ è¾“ |
| GBN | Lab2-2/ | 10 | 1 | å›é€€N | ä¸­ | ä½ä¸¢åŒ…ç½‘ç»œ |
| SR | Lab2-2/SR_protocol/ | 10 | **10** | **é€‰æ‹©** | **é«˜** | é«˜é€Ÿ/é«˜ä¸¢åŒ… |

## å¿«é€Ÿå¼€å§‹æŒ‡å—

### 1. æµ‹è¯•åœç­‰åè®®

```bash
# ç»ˆç«¯1
cd Lab2-1
g++ server.cpp -o server.exe -lws2_32
./server.exe

# ç»ˆç«¯2
cd Lab2-1
g++ client.cpp -o client.exe -lws2_32
./client.exe
# è¾“å…¥: -test 0.2
```

### 2. æµ‹è¯•åŒå‘åœç­‰åè®®

```bash
# ç»ˆç«¯1
cd Lab2-1/bidirectional
g++ server.cpp -o server.exe -lws2_32
./server.exe

# ç»ˆç«¯2
cd Lab2-1/bidirectional
g++ client.cpp -o client.exe -lws2_32
./client.exe
# è¾“å…¥: -both 0.2
```

### 3. æµ‹è¯•æ–‡ä»¶ä¼ è¾“

```bash
# ç»ˆç«¯1
cd Lab2-1/file_transfer
g++ server.cpp -o server.exe -lws2_32
./server.exe

# ç»ˆç«¯2
cd Lab2-1/file_transfer
g++ client.cpp -o client.exe -lws2_32
./client.exe
# è¾“å…¥: -upload test_file.txt 0.2
```

### 4. æµ‹è¯•GBNåè®®

```bash
# ç»ˆç«¯1
cd Lab2-2
g++ server.cpp -o server.exe -lws2_32
./server.exe

# ç»ˆç«¯2
cd Lab2-2
g++ client.cpp -o client.exe -lws2_32
./client.exe
# è¾“å…¥: -testgbn 0.2 0.2
```

### 5. æµ‹è¯•SRåè®®

```bash
# ç»ˆç«¯1
cd Lab2-2/SR_protocol
g++ server.cpp -o server.exe -lws2_32
./server.exe

# ç»ˆç«¯2
cd Lab2-2/SR_protocol
g++ client.cpp -o client.exe -lws2_32
./client.exe
# è¾“å…¥: -testsr 0.3 0.2
```

## æ ¸å¿ƒæŠ€æœ¯è¦ç‚¹

### 1. åœç­‰åè®®

**å…³é”®ä»£ç **:
```cpp
// å‘é€å¹¶ç­‰å¾…ACK
while (attempts < MAX_ATTEMPTS) {
    sendto(...);  // å‘é€æ•°æ®å¸§

    select(..., timeout);  // ç­‰å¾…ACK(å¸¦è¶…æ—¶)

    if (æ”¶åˆ°æ­£ç¡®ACK) {
        seq = 1 - seq;  // åˆ‡æ¢åºåˆ—å·
        break;
    }

    attempts++;  // è¶…æ—¶é‡ä¼ 
}
```

### 2. GBNåè®®

**å…³é”®ä»£ç **:
```cpp
// å‘é€çª—å£å†…æ•°æ®
while (seqIsAvailable() && curSeq < totalPacket) {
    sendto(..., packets[curSeq]);
    curSeq++;
}

// ç´¯ç§¯ç¡®è®¤
void ackHandler(unsigned char ack) {
    for (int i = curAck; i <= ack; i++) {
        ack[i] = TRUE;
    }
    // æ»‘åŠ¨çª—å£
    while (ack[curAck]) curAck++;
}

// è¶…æ—¶å›é€€é‡ä¼ 
void timeoutHandler() {
    for (int i = curAck; i < curSeq; i++) {
        sendto(..., packets[i]);  // é‡ä¼ æ‰€æœ‰
    }
}
```

### 3. SRåè®®

**å…³é”®ä»£ç **:
```cpp
// æ¥æ”¶çª—å£>1,ç¼“å­˜ä¹±åºåŒ…
if (inRecvWindow(seq)) {
    recvBuffer[seq] = frame;  // ç¼“å­˜
    recvAck[seq] = TRUE;
    sendAck(seq);  // ç‹¬ç«‹ACK

    // å¦‚æœæ˜¯recvBase,äº¤ä»˜è¿ç»­æ•°æ®
    if (seq == recvBase) {
        while (recvAck[recvBase]) {
            deliver(recvBuffer[recvBase]);
            recvBase++;
        }
    }
}

// é€‰æ‹©é‡ä¼ 
void selectiveRetransmit() {
    for (int i = sendBase; i < nextSeq; i++) {
        if (!sendAck[i]) {  // åªä¼ æœªç¡®è®¤çš„
            sendto(..., packets[i]);
        }
    }
}
```

## å®éªŒç»“æœç¤ºä¾‹

### åœç­‰åè®®æµ‹è¯•

```
[å‘é€] Seq=0, æ•°æ®="è¿™æ˜¯ç¬¬ä¸€ä¸ªæ•°æ®åŒ…", å°è¯•=1
[æ¥æ”¶ACK] ACK=0
[æˆåŠŸ] æ”¶åˆ°æ­£ç¡®ACK

[å‘é€] Seq=1, æ•°æ®="è¿™æ˜¯ç¬¬äºŒä¸ªæ•°æ®åŒ…", å°è¯•=1
[è¶…æ—¶] æœªæ”¶åˆ°ACK, å‡†å¤‡é‡ä¼ ...
[å‘é€] Seq=1, æ•°æ®="è¿™æ˜¯ç¬¬äºŒä¸ªæ•°æ®åŒ…", å°è¯•=2
[æ¥æ”¶ACK] ACK=1
[æˆåŠŸ] æ”¶åˆ°æ­£ç¡®ACK

[å®Œæˆ] æ‰€æœ‰æ•°æ®åŒ…å·²æˆåŠŸå‘é€
```

### GBNåè®®æµ‹è¯•

```
[çª—å£çŠ¶æ€] curAck=0, curSeq=0, çª—å£å¤§å°=10
  [|Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—|         ]

[å‘é€] Seq=0, æ•°æ®="æ•°æ®åŒ…1:GBNåè®®æµ‹è¯•å¼€å§‹"
[å‘é€] Seq=1, æ•°æ®="æ•°æ®åŒ…2:Go-Back-Næµ‹è¯•"
...
[å‘é€] Seq=9, æ•°æ®="æ•°æ®åŒ…10:è®¡ç®—æœºç½‘ç»œ"

[ACKå¤„ç†] æ”¶åˆ°ACK=5
[çª—å£æ»‘åŠ¨] æ–°çš„curAck=6

[è¶…æ—¶] æ£€æµ‹åˆ°è¶…æ—¶,é‡ä¼ çª—å£å†…æ‰€æœ‰æ•°æ®åŒ…...
[é‡ä¼ ] Seq=6, æ•°æ®="..."
[é‡ä¼ ] Seq=7, æ•°æ®="..."
...
```

### SRåè®®æµ‹è¯•

```
[æ¥æ”¶] Seq=2, æ•°æ®="SR-3:ç¼“å­˜ä¹±åºåŒ…"
[ä¹±åº] Seq=2 ä¸æ˜¯æœŸæœ›çš„ 0, ç¼“å­˜!
[å‘é€ACK] ACK=2
  çª—å£[|Â·Ã—Â·.......|       ] base=0
      â†‘ æ”¶åˆ°2,ç¼º0,1

[æ¥æ”¶] Seq=0, æ•°æ®="SR-1:é€‰æ‹©é‡ä¼ åè®®"
[æŒ‰åº] Seq=0
[äº¤ä»˜] å¼€å§‹äº¤ä»˜è¿ç»­æ•°æ®:
  -> Seq=0, æ•°æ®="SR-1:é€‰æ‹©é‡ä¼ åè®®"
  æ–°recvBase=1

[é€‰æ‹©é‡ä¼ ] å…±é‡ä¼  1 ä¸ªæ•°æ®åŒ…  <- åªä¼ ä¸¢å¤±çš„!
```

## æ€§èƒ½å¯¹æ¯”

### é‡ä¼ æ•ˆç‡å¯¹æ¯”

**åœºæ™¯**: çª—å£å¤§å°10,Seq=2ä¸¢å¤±

| åè®® | ä¸¢å¤±åŒ…æ•° | é‡ä¼ åŒ…æ•° | æ•ˆç‡ |
|------|---------|---------|-----|
| åœç­‰ | 1 | 1 | 100% |
| GBN | 1 | 8 (2-9) | 12.5% |
| SR | 1 | 1 | **100%** |

### ååé‡å¯¹æ¯”

**ç†æƒ³æ¡ä»¶**(æ— ä¸¢åŒ…,RTT=100ms,æ•°æ®åŒ…=1KB):

| åè®® | ååé‡ | è¯´æ˜ |
|------|-------|-----|
| åœç­‰ | ~10 KB/s | 1åŒ…/RTT |
| GBN | ~100 KB/s | 10åŒ…/RTT |
| SR | ~100 KB/s | 10åŒ…/RTT |

**æœ‰ä¸¢åŒ…**(10%ä¸¢åŒ…ç‡):

| åè®® | ååé‡ | ä¸‹é™ |
|------|-------|-----|
| åœç­‰ | ~9 KB/s | -10% |
| GBN | ~40 KB/s | -60% |
| SR | ~90 KB/s | **-10%** |

## å®éªŒæ”¶è·

### åè®®ç†è§£

1. **åœç­‰åè®®**
   - âœ… æœ€ç®€å•çš„å¯é ä¼ è¾“åè®®
   - âœ… åºåˆ—å·0/1äº¤æ›¿
   - âœ… è¶…æ—¶é‡ä¼ æœºåˆ¶
   - âš ï¸ æ•ˆç‡ä½,é€‚åˆç®€å•åœºæ™¯

2. **GBNåè®®**
   - âœ… æ»‘åŠ¨çª—å£æé«˜æ•ˆç‡
   - âœ… ç´¯ç§¯ç¡®è®¤å‡å°‘ACK
   - âœ… å®ç°ç›¸å¯¹ç®€å•
   - âš ï¸ å›é€€é‡ä¼ æœ‰æµªè´¹

3. **SRåè®®**
   - âœ… æ•ˆç‡æœ€é«˜
   - âœ… ç¼“å­˜ä¹±åºåŒ…
   - âœ… é€‰æ‹©é‡ä¼ 
   - âš ï¸ å®ç°å¤æ‚,ç¼“å­˜éœ€æ±‚å¤§

### æŠ€æœ¯æŒæ¡

- âœ… UDP Socketç¼–ç¨‹
- âœ… éé˜»å¡I/Oå’Œè¶…æ—¶æœºåˆ¶
- âœ… æ»‘åŠ¨çª—å£ç®—æ³•
- âœ… åºåˆ—å·ç®¡ç†å’Œå›ç»•å¤„ç†
- âœ… ä¸¢åŒ…æ¨¡æ‹Ÿå’Œç½‘ç»œæµ‹è¯•
- âœ… æ–‡ä»¶ä¼ è¾“åº”ç”¨è®¾è®¡

### å·¥ç¨‹èƒ½åŠ›

- âœ… æ¨¡å—åŒ–è®¾è®¡
- âœ… é”™è¯¯å¤„ç†
- âœ… ä»£ç æ³¨é‡Šå’Œæ–‡æ¡£
- âœ… æµ‹è¯•ç”¨ä¾‹è®¾è®¡
- âœ… æ€§èƒ½åˆ†æ

## å®éªŒæŠ¥å‘Šå»ºè®®

### æŠ¥å‘Šç»“æ„

1. **å®éªŒç›®çš„å’Œç¯å¢ƒ**
2. **åè®®è®¾è®¡**
   - æ•°æ®å¸§æ ¼å¼
   - ACKå¸§æ ¼å¼
   - çŠ¶æ€æœºè®¾è®¡
3. **ç¨‹åºæµç¨‹**
   - å‘é€ç«¯æµç¨‹å›¾
   - æ¥æ”¶ç«¯æµç¨‹å›¾
   - äº¤äº’æ—¶åºå›¾
4. **å…³é”®ä»£ç **
   - è¶…æ—¶é‡ä¼ å®ç°
   - çª—å£ç®¡ç†å®ç°
   - ä¹±åºå¤„ç†(SR)
5. **æµ‹è¯•ç»“æœ**
   - æ­£å¸¸ä¼ è¾“æµ‹è¯•
   - ä¸¢åŒ…æµ‹è¯•æˆªå›¾
   - æ€§èƒ½å¯¹æ¯”æ•°æ®
6. **é—®é¢˜ä¸è§£å†³**
7. **å®éªŒæ€»ç»“**

### æ¨èå±•ç¤ºå†…å®¹

**å¿…åš**:
- åœç­‰/GBNåŸºæœ¬åŠŸèƒ½æ¼”ç¤º
- ä¸¢åŒ…æƒ…å†µä¸‹çš„é‡ä¼ 

**åŠ åˆ†**:
- åŒå‘ä¼ è¾“æ¼”ç¤º
- æ–‡ä»¶ä¼ è¾“æ¼”ç¤º
- SRåè®®æ•ˆç‡ä¼˜åŠ¿å±•ç¤º
- æ€§èƒ½å¯¹æ¯”å›¾è¡¨

## æ³¨æ„äº‹é¡¹

### ç¼–è¯‘

```bash
# Windowsä¸‹ç¼–è¯‘éœ€è¦é“¾æ¥ws2_32åº“
g++ server.cpp -o server.exe -lws2_32
g++ client.cpp -o client.exe -lws2_32
```

### è¿è¡Œ

1. å…ˆå¯åŠ¨æœåŠ¡å™¨,å†å¯åŠ¨å®¢æˆ·ç«¯
2. ç¡®ä¿é˜²ç«å¢™å…è®¸UDP 12340ç«¯å£
3. æœ¬æœºæµ‹è¯•ä½¿ç”¨127.0.0.1
4. ä¸¢åŒ…ç‡å»ºè®®0.2-0.3,è¿‡é«˜ä¼šå¾ˆæ…¢

### å¸¸è§é—®é¢˜

**Q: ç¼–è¯‘æŠ¥é”™æ‰¾ä¸åˆ°winsock2.h?**
A: ä½¿ç”¨MinGWæˆ–MSVCç¼–è¯‘å™¨

**Q: ç«¯å£è¢«å ç”¨?**
A: ä¿®æ”¹SERVER_PORTå®å®šä¹‰

**Q: ä¸€ç›´è¶…æ—¶æ²¡å“åº”?**
A: æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨,é˜²ç«å¢™è®¾ç½®

**Q: æ–‡ä»¶ä¼ è¾“åå†…å®¹ä¸ä¸€è‡´?**
A: æ£€æŸ¥äºŒè¿›åˆ¶æ¨¡å¼(ios::binary)

## æ‰©å±•æ–¹å‘

### è¿›é˜¶å®éªŒ

1. **åŠ¨æ€è¶…æ—¶**
   - å®ç°ç±»ä¼¼TCPçš„RTTä¼°è®¡
   - è‡ªé€‚åº”è¶…æ—¶æ—¶é—´

2. **æ‹¥å¡æ§åˆ¶**
   - æ…¢å¯åŠ¨
   - æ‹¥å¡é¿å…
   - å¿«é€Ÿé‡ä¼ å’Œå¿«é€Ÿæ¢å¤

3. **æµé‡æ§åˆ¶**
   - æ¥æ”¶æ–¹é€šå‘Šçª—å£
   - æ»‘åŠ¨çª—å£åŠ¨æ€è°ƒæ•´

4. **å¯é UDPåº“**
   - å°è£…ä¸ºé€šç”¨åº“
   - æ”¯æŒå¤šè¿æ¥
   - åº”ç”¨å±‚åè®®è®¾è®¡

### å®é™…åº”ç”¨

- è‡ªå®šä¹‰å¯é ä¼ è¾“åè®®
- P2Pæ–‡ä»¶ä¼ è¾“
- è§†é¢‘æµä¼ è¾“
- ç‰©è”ç½‘é€šä¿¡

## æ€»ç»“

æœ¬å®éªŒå®Œæ•´å®ç°äº†ä»**åœç­‰åè®®**åˆ°**GBNåè®®**å†åˆ°**SRåè®®**çš„æ¼”è¿›è¿‡ç¨‹,æ·±å…¥ç†è§£äº†:

- å¯é æ•°æ®ä¼ è¾“çš„æ ¸å¿ƒæœºåˆ¶
- æ»‘åŠ¨çª—å£åè®®çš„è®¾è®¡æ€æƒ³
- ä¸åŒåè®®çš„æƒè¡¡å–èˆ
- ç½‘ç»œç¼–ç¨‹çš„å®è·µæŠ€æœ¯

é€šè¿‡**å¿…åš+é€‰åš**çš„å®Œæ•´å®ç°,ä¸ä»…æŒæ¡äº†ç†è®ºçŸ¥è¯†,æ›´è·å¾—äº†å®è´µçš„å·¥ç¨‹å®è·µç»éªŒ!

---

**å®éªŒå®Œæˆåº¦**: 100% (å¿…åš + å…¨éƒ¨é€‰åš)

**æ¨èå­¦ä¹ é¡ºåº**: åœç­‰ â†’ GBN â†’ SR â†’ æ–‡ä»¶ä¼ è¾“ â†’ åŒå‘é€šä¿¡
