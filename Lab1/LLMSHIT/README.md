# HTTP代理服务器使用说明

## 项目简介
这是一个基于C++实现的HTTP代理服务器，支持多线程并发处理客户端请求。

## 功能特性
- ✅ 基本HTTP代理功能（GET/POST请求）
- ✅ 多线程并发处理
- ✅ 自动解析HTTP请求头
- ✅ 转发请求和响应
- ✅ 详细的日志输出

## 编译方法

### 使用Visual Studio编译
1. 打开Visual Studio（推荐2019或更高版本）
2. 创建新的C++控制台项目
3. 将`ProxyServer.cpp`添加到项目中
4. 配置项目属性：
   - 平台：Win32或x64
   - 字符集：使用多字节字符集
5. 编译并运行（Ctrl+F5）

### 使用命令行编译（cl.exe）
```cmd
cl ProxyServer.cpp /EHsc Ws2_32.lib
```

### 使用MinGW-w64编译
```cmd
g++ ProxyServer.cpp -o ProxyServer.exe -lws2_32 -static
```

## 运行方法

### 1. 启动代理服务器
```cmd
ProxyServer.exe
```
启动后会看到类似输出：
```
========================================
       HTTP 代理服务器 v1.0
========================================
代理服务器正在启动...
初始化Socket...
代理服务器启动成功!
监听端口: 8080
等待客户端连接...
========================================
```

### 2. 配置浏览器代理

#### Chrome/Edge浏览器配置
1. 打开浏览器设置
2. 搜索"代理"
3. 点击"打开代理设置"
4. 在"局域网设置"中：
   - 勾选"为LAN使用代理服务器"
   - 地址：`127.0.0.1`
   - 端口：`8080`
5. 点击确定

#### Firefox浏览器配置
1. 打开设置 → 常规 → 网络设置
2. 选择"手动代理配置"
3. HTTP代理：`127.0.0.1`，端口：`8080`
4. 勾选"也将此代理用于HTTPS"
5. 点击确定

### 3. 测试代理
在浏览器中访问HTTP网站（如 http://www.example.com ），代理服务器控制台会显示详细的请求处理过程。

**注意：** 本代理服务器仅支持HTTP协议，不支持HTTPS。访问HTTPS网站可能会失败。

## 代码结构说明

### 核心函数
- `InitSocket()` - 初始化Winsock并创建监听套接字
- `ProxyThread()` - 处理单个客户端请求的线程函数
- `ParseHttpHead()` - 解析HTTP请求头
- `ConnectToServer()` - 连接目标Web服务器

### 数据结构
- `HttpHeader` - 存储HTTP请求头信息
- `ProxyParam` - 线程参数结构

### 工作流程
1. 主线程监听8080端口
2. 接收到客户端连接后创建新线程
3. 子线程接收HTTP请求并解析
4. 连接目标服务器并转发请求
5. 接收目标服务器响应
6. 转发响应给客户端
7. 关闭连接

## 常见问题

### Q: 端口被占用怎么办？
A: 修改代码中的`ProxyPort`常量为其他端口（如10240），并在浏览器中配置相应端口。

### Q: 无法访问HTTPS网站？
A: 本代理服务器仅支持HTTP协议。HTTPS需要实现CONNECT方法和SSL/TLS隧道，属于扩展功能。

### Q: 编译时找不到Winsock库？
A: 确保添加了`#pragma comment(lib,"Ws2_32.lib")`或在编译命令中链接`Ws2_32.lib`。

### Q: 代理服务器启动后无响应？
A: 检查防火墙是否阻止了端口，或者端口是否已被其他程序占用。

## 扩展功能建议

### 1. 缓存功能
- 使用文件或内存缓存HTTP响应
- 添加If-Modified-Since头部验证缓存
- 实现LRU缓存淘汰策略

### 2. 网站过滤
- 维护黑名单/白名单
- 根据Host字段过滤请求
- 返回自定义错误页面

### 3. 日志记录
- 记录所有请求到文件
- 统计访问次数和流量
- 支持日志轮转

## 技术要点

### 多线程并发
使用`_beginthreadex`创建线程，每个客户端连接由独立线程处理，实现并发访问。

### Socket编程
- TCP套接字通信
- 非阻塞/阻塞IO
- 超时设置

### HTTP协议
- 请求行解析（方法、URL、版本）
- 请求头解析（Host、Cookie等）
- 透明转发机制

## 实验报告建议内容

1. **设计思路**：说明代理服务器的整体架构和工作流程
2. **关键代码**：展示核心函数实现
3. **测试结果**：截图展示代理服务器运行日志和浏览器访问效果
4. **问题与解决**：记录遇到的问题和解决方案
5. **性能分析**：测试并发性能、响应时间等
6. **心得体会**：总结Socket编程和HTTP协议的理解

## 参考资料
- RFC 2616: HTTP/1.1协议规范
- Winsock编程文档
- 计算机网络实验教材

## 许可
本代码仅用于教学实验目的。
