<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>缓存测试页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .container {
            background-color: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h1 {
            color: #667eea;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        .test-section {
            background-color: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
        }
        .timestamp {
            background-color: #e7f3ff;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }
        .steps {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 20px;
            border-radius: 6px;
            margin: 20px 0;
        }
        .steps ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        .steps li {
            margin: 8px 0;
            line-height: 1.6;
        }
        code {
            background-color: #f4f4f4;
            padding: 3px 8px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #e83e8c;
        }
        .important {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
        }
        .success {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        table th, table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        table th {
            background-color: #667eea;
            color: white;
        }
        table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚀 HTTP 代理服务器缓存功能测试页面</h1>

        <div class="timestamp">
            <strong>页面生成时间：</strong><span id="generation-time"></span><br>
            <strong>当前访问时间：</strong><span id="access-time"></span>
        </div>

        <div class="test-section">
            <h2>📋 测试目标</h2>
            <p>验证代理服务器的缓存功能是否正常工作，包括：</p>
            <ul>
                <li>✓ 首次请求时保存缓存</li>
                <li>✓ 后续请求时使用 If-Modified-Since 验证</li>
                <li>✓ 服务器返回 304 时使用本地缓存</li>
                <li>✓ 缓存文件正确保存和读取</li>
            </ul>
        </div>

        <div class="steps">
            <h3>🔬 测试步骤</h3>
            <ol>
                <li><strong>启动测试服务器：</strong>
                    <br><code>cd test_http_server</code>
                    <br><code>python test_cache_server.py</code>
                </li>
                <li><strong>启动代理服务器：</strong>
                    <br><code>ProxyServerWithCache.exe</code>
                </li>
                <li><strong>配置浏览器代理：</strong>
                    <br>设置为 <code>127.0.0.1:8080</code>
                </li>
                <li><strong>首次访问：</strong>
                    <br>访问 <code>http://127.0.0.1/cache_test.html</code>
                    <br>观察代理服务器输出 <code>[缓存] 已保存</code>
                </li>
                <li><strong>再次访问：</strong>
                    <br>刷新页面（F5）
                    <br>观察代理服务器输出 <code>[缓存] 找到缓存</code> 和 <code>[缓存] 服务器返回304</code>
                </li>
                <li><strong>验证缓存文件：</strong>
                    <br>检查 <code>cache\</code> 目录是否生成了 <code>.cache</code> 文件
                </li>
            </ol>
        </div>

        <div class="test-section">
            <h3>📊 预期结果对比</h3>
            <table>
                <thead>
                    <tr>
                        <th>请求次数</th>
                        <th>代理服务器日志</th>
                        <th>HTTP 状态码</th>
                        <th>说明</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>第 1 次</td>
                        <td><code>[缓存] 已保存: ...</code></td>
                        <td>200 OK</td>
                        <td>首次请求，保存到缓存</td>
                    </tr>
                    <tr>
                        <td>第 2 次</td>
                        <td><code>[缓存] 找到缓存，验证新鲜度...</code><br><code>[缓存] 服务器返回304，使用缓存</code></td>
                        <td>304 Not Modified</td>
                        <td>从缓存读取，速度快</td>
                    </tr>
                    <tr>
                        <td>第 3+ 次</td>
                        <td>同第 2 次</td>
                        <td>304 Not Modified</td>
                        <td>持续使用缓存</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="important">
            <h3>⚠️ 注意事项</h3>
            <ul>
                <li>测试服务器脚本会正确处理 <code>If-Modified-Since</code> 请求头</li>
                <li>如果看不到 304 响应，检查服务器是否正确设置 <code>Last-Modified</code> 头部</li>
                <li>清空缓存：删除 <code>cache\</code> 目录下的所有文件</li>
                <li>使用 <code>Ctrl+F5</code> 强制刷新会绕过缓存（浏览器行为）</li>
            </ul>
        </div>

        <div class="success">
            <h3>✅ 成功标志</h3>
            <p>如果看到以下现象，说明缓存功能正常：</p>
            <ul>
                <li>第一次访问后，<code>cache\</code> 目录生成了缓存文件</li>
                <li>第二次访问时，代理服务器日志显示"服务器返回304"</li>
                <li>第二次访问速度明显快于第一次</li>
                <li>测试服务器日志显示收到了 <code>If-Modified-Since</code> 请求头</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>🎨 动态内容</h3>
            <p>页面访问时间：<strong id="dynamic-time" style="color: #667eea;"></strong></p>
            <p>随机数：<strong id="random-number" style="color: #764ba2;"></strong></p>
            <p style="color: #666; font-size: 0.9em;">注意：如果这些值在刷新后没有变化，说明浏览器使用了本地缓存（200 from cache）或代理缓存（304）</p>
        </div>
    </div>

    <script>
        // 显示生成时间（服务器时间，固定的）
        document.getElementById('generation-time').textContent = new Date().toLocaleString('zh-CN');

        // 显示当前访问时间
        function updateTime() {
            document.getElementById('access-time').textContent = new Date().toLocaleString('zh-CN');
            document.getElementById('dynamic-time').textContent = new Date().toLocaleTimeString('zh-CN');
        }
        updateTime();
        setInterval(updateTime, 1000);

        // 显示随机数
        document.getElementById('random-number').textContent = Math.floor(Math.random() * 10000);
    </script>
</body>
</html>
